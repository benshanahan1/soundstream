<html>
    <head>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@0.10.2/lib/p5.js"></script>
    <script type="text/javascript" charset="utf-8">
        function setup() {
            createCanvas(400, 800);

            const socket = io.connect()

            socket.on('connect', function() {
                console.log('connected to server');
                socket.emit('start stream');  // request start data stream
            });

            socket.on('disconnect', function() {
                console.log('disconnected from server');
            });

            socket.on('data frame', function(rawFrame) {
                const { success, is_data, data } = JSON.parse(rawFrame);

                if (!is_data) {
                    console.log('no data');
                } else {
                    clear();
                    strokeWeight(5);
                    for (let i = 0; i < data.length; i++) {
                        line(0, 10 + 7 * i, data[i], 10 + 7*i );
                    }
                }
            });
        }
    </script>
</head>
<body>
    <h1>Socket-IO test</h1>
    <p>Data throughput test.</p>
</body>
</html>
